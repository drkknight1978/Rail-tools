<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Railway Week Number Calendar</title>
    <script src="auth.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .back-link {
            display: inline-block;
            color: #667eea;
            text-decoration: none;
            font-size: 16px;
            margin-bottom: 15px;
            transition: transform 0.2s;
        }

        .back-link:hover {
            transform: translateX(-5px);
        }

        h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .info-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .current-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .info-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .info-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 2em;
            font-weight: bold;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }

        .nav-btn:active {
            transform: translateY(0);
        }

        .month-year {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
        }

        .calendar-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .day-header {
            text-align: center;
            font-weight: bold;
            padding: 15px 5px;
            color: #667eea;
            font-size: 1.1em;
        }

        .day-cell {
            position: relative;
            aspect-ratio: 1;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            cursor: pointer;
            background: white;
            overflow: visible;
        }

        .day-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
            z-index: 10;
        }

        .day-cell.other-month {
            opacity: 0.3;
        }

        .day-cell.today {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            font-weight: bold;
        }

        .day-cell.weekend {
            background: #f8f8ff;
        }

        .day-number {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .day-info {
            font-size: 0.7em;
            text-align: center;
            line-height: 1.2;
        }

        .week-label {
            color: #667eea;
            font-weight: bold;
        }

        .period-label {
            color: #764ba2;
            font-weight: bold;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-box {
            width: 30px;
            height: 30px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }

        .legend-box.today {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .legend-box.weekend {
            background: #f8f8ff;
            border-color: #e0e0e0;
        }

        .year-info {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            color: #333;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            .calendar {
                gap: 5px;
            }

            .day-header {
                font-size: 0.9em;
                padding: 10px 2px;
            }

            .day-number {
                font-size: 1em;
            }

            .day-info {
                font-size: 0.6em;
            }

            .nav-btn {
                padding: 10px 16px;
                font-size: 14px;
            }

            .month-year {
                font-size: 1.3em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="index.html" class="back-link">← Back to Home</a>
            <h1>Railway Week Number Calendar</h1>
            <p class="subtitle">Navigate through railway weeks and periods with precision</p>
        </div>

        <div class="info-panel">
            <div class="current-info">
                <div class="info-card">
                    <div class="info-label">Today's Week</div>
                    <div class="info-value" id="currentWeek">-</div>
                </div>
                <div class="info-card">
                    <div class="info-label">Current Period</div>
                    <div class="info-value" id="currentPeriod">-</div>
                </div>
                <div class="info-card">
                    <div class="info-label">Railway Year</div>
                    <div class="info-value" id="railwayYear">-</div>
                </div>
            </div>
            <div id="yearInfo" class="year-info"></div>
        </div>

        <div class="calendar-container">
            <div class="navigation">
                <div class="nav-buttons">
                    <button class="nav-btn" onclick="previousMonth()">← Previous</button>
                    <button class="nav-btn" onclick="goToToday()">Today</button>
                    <button class="nav-btn" onclick="nextMonth()">Next →</button>
                </div>
                <div class="month-year" id="monthYear"></div>
            </div>

            <div class="calendar" id="calendar"></div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-box today"></div>
                    <span>Today</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box weekend"></div>
                    <span>Weekend</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Railway week calculation logic
        class RailwayCalendar {
            constructor() {
                this.currentDate = new Date();
                this.viewDate = new Date();
            }

            // Find the last Saturday of March for a given year
            getLastSaturdayOfMarch(year) {
                // Start from March 31st and work backwards to find Saturday
                for (let day = 31; day >= 25; day--) {
                    const date = new Date(year, 2, day); // Month 2 = March (0-indexed)
                    if (date.getDay() === 6) { // 6 = Saturday
                        return date;
                    }
                }
                return new Date(year, 2, 31); // Fallback
            }

            // Get the railway year start date for a given date
            getRailwayYearStart(date) {
                const year = date.getFullYear();
                const lastSatMarchCurrent = this.getLastSaturdayOfMarch(year);
                const lastSatMarchNext = this.getLastSaturdayOfMarch(year + 1);

                // If date is before last Saturday of March, we're in the previous railway year
                if (date < lastSatMarchCurrent) {
                    return this.getLastSaturdayOfMarch(year - 1);
                } else {
                    return lastSatMarchCurrent;
                }
            }

            // Get railway year end date
            getRailwayYearEnd(yearStart) {
                const year = yearStart.getFullYear();
                return this.getLastSaturdayOfMarch(year + 1);
            }

            // Calculate railway week number for a given date
            getRailwayWeek(date) {
                const yearStart = this.getRailwayYearStart(date);
                const daysSinceStart = Math.floor((date - yearStart) / (1000 * 60 * 60 * 24));
                const weekNumber = Math.floor(daysSinceStart / 7) + 1;

                return {
                    week: weekNumber,
                    yearStart: yearStart,
                    railwayYear: yearStart.getFullYear()
                };
            }

            // Calculate period number (4 weeks = 1 period)
            getRailwayPeriod(weekNumber) {
                return Math.ceil(weekNumber / 4);
            }

            // Get week number for a specific date (considering weeks start on Saturday)
            getWeekInfo(date) {
                const info = this.getRailwayWeek(date);
                return {
                    week: info.week,
                    period: this.getRailwayPeriod(info.week),
                    railwayYear: info.railwayYear,
                    yearStart: info.yearStart
                };
            }
        }

        const railwayCal = new RailwayCalendar();
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        function updateCurrentInfo() {
            const today = new Date();
            const info = railwayCal.getWeekInfo(today);

            document.getElementById('currentWeek').textContent = info.week;
            document.getElementById('currentPeriod').textContent = info.period;
            document.getElementById('railwayYear').textContent = info.railwayYear;

            const yearEnd = railwayCal.getRailwayYearEnd(info.yearStart);
            const options = { year: 'numeric', month: 'long', day: 'numeric' };

            document.getElementById('yearInfo').innerHTML =
                `Railway Year ${info.railwayYear}: Week 1 starts ${info.yearStart.toLocaleDateString('en-GB', options)} • ` +
                `Year ends ${yearEnd.toLocaleDateString('en-GB', options)}`;
        }

        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            const monthYear = document.getElementById('monthYear');

            // Clear calendar
            calendar.innerHTML = '';

            // Set month/year display
            const months = ['January', 'February', 'March', 'April', 'May', 'June',
                          'July', 'August', 'September', 'October', 'November', 'December'];
            monthYear.textContent = `${months[currentMonth]} ${currentYear}`;

            // Add day headers
            const days = ['Sat', 'Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri'];
            days.forEach(day => {
                const header = document.createElement('div');
                header.className = 'day-header';
                header.textContent = day;
                calendar.appendChild(header);
            });

            // Get first day of month and number of days
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const daysInMonth = lastDay.getDate();

            // Adjust to start on Saturday (6)
            let startDay = firstDay.getDay();
            // Convert so Saturday = 0, Sunday = 1, ..., Friday = 6
            startDay = (startDay + 1) % 7;

            // Add empty cells for days before month starts
            for (let i = 0; i < startDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'day-cell other-month';

                // Calculate previous month's date
                const prevMonthDate = new Date(currentYear, currentMonth, 1 - (startDay - i));
                emptyCell.innerHTML = `<div class="day-number">${prevMonthDate.getDate()}</div>`;
                calendar.appendChild(emptyCell);
            }

            // Add days of the month
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(currentYear, currentMonth, day);
                const cell = document.createElement('div');
                cell.className = 'day-cell';

                // Check if weekend (Saturday = 6, Sunday = 0)
                const dayOfWeek = date.getDay();
                if (dayOfWeek === 0 || dayOfWeek === 6) {
                    cell.classList.add('weekend');
                }

                // Check if today
                if (date.getTime() === today.getTime()) {
                    cell.classList.add('today');
                }

                // Get railway week info
                const info = railwayCal.getWeekInfo(date);

                cell.innerHTML = `
                    <div class="day-number">${day}</div>
                    <div class="day-info">
                        <div class="week-label">W${info.week}</div>
                        <div class="period-label">P${info.period}</div>
                    </div>
                `;

                calendar.appendChild(cell);
            }

            // Add remaining cells to complete the grid
            const totalCells = calendar.children.length - 7; // Subtract headers
            const remainingCells = (7 - (totalCells % 7)) % 7;

            for (let i = 1; i <= remainingCells; i++) {
                const nextMonthDate = new Date(currentYear, currentMonth + 1, i);
                const emptyCell = document.createElement('div');
                emptyCell.className = 'day-cell other-month';
                emptyCell.innerHTML = `<div class="day-number">${i}</div>`;
                calendar.appendChild(emptyCell);
            }
        }

        function previousMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        }

        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        }

        function goToToday() {
            const today = new Date();
            currentMonth = today.getMonth();
            currentYear = today.getFullYear();
            renderCalendar();
        }

        // Initialize
        updateCurrentInfo();
        renderCalendar();
    </script>
</body>
</html>
