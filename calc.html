<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voltage Drop Iterative Calculator</title>
<link rel="stylesheet" href="classic_style.css" id="styleSheet"> <!-- Added the id="styleSheet" here -->
<link rel="stylesheet" href="common_styles.css">

</head>
<body>
<div class="container">
	<h1>Voltage Drop Iterative Calculator</h1>
    <div class="button-panel">
	    <h1> Style Settings </h1>
        <button onclick="changeStyle('classic_style.css')">Classic Style</button>
        <button onclick="changeStyle('60s_style.css')">60's Style</button>
        <button onclick="changeStyle('glass_and_crystals_style.css')">Glass & Crystals Style</button>
        <button onclick="changeStyle('modern_style.css')">Modern Style</button>
    </div>

    <label for="conductor">Select Conductor:</label>
    <select id="conductor">
        <option value="49.6">0.75mm²</option>
        <option value="36.2">1.00mm²</option>
        <option value="34.6">1.15mm²</option>
        <option value="24.4">1.5mm²</option>
        <option value="15.1">2.5mm²</option>
        <option value="16.4" selected>2.5mm² (f)</option>
        <option value="9.22">4.0mm²</option>
        <option value="3.68">10mm²</option>
        <option value="2.32">16mm²</option>
        <option value="1.45">25mm²</option>
        <option value="1.06">35mm²</option>
        <option value="0.54">70mm²</option>
        <option value="0.39">95mm²</option>
    </select>

    <label for="length">Cable Length (km):</label>
    <input type="number" id="length" value="0.1">

    <label for="load">Power Load (VA):</label>
    <input type="number" id="load" value="825">

    <label for="voltage">Supplied Voltage (V):</label>
    <input type="number" id="voltage" value="120">

    <button onclick="calculateVoltageDropIterative()">Calculate</button>

    <p id="results"></p>
</div>

<script>
function calculateVoltageDropIterative() {
    const R_cable = parseFloat(document.getElementById("conductor").value);
    const L_cable = parseFloat(document.getElementById("length").value);
    const P_load = parseFloat(document.getElementById("load").value);
    const V_supplied = parseFloat(document.getElementById("voltage").value);

    let V_load = V_supplied; // Initial assumption: no voltage drop
    let tolerance = 0.01; // Voltage stability tolerance
    let error = 1;
    let iterations = 0;
    let I_load;

    while (error > tolerance) {
        iterations++;
        const R = R_cable * L_cable;
        const V_load_new = V_supplied - (P_load / V_load) * R;
        I_load = P_load / V_load;

        // Update error measure
        error = Math.abs(V_load_new - V_load);
        V_load = V_load_new; // Update load voltage for next iteration

        if (iterations > 100000) { // Prevent infinite loops
            break;
        }
    }

    document.getElementById("results").innerHTML = `Voltage at the load: ${V_load.toFixed(2)} V<br>Current drawn by the load: ${I_load.toFixed(2)} A<br>Iterations: ${iterations}`;
}
</script>
<script>
function changeStyle(sheet) {
    document.getElementById('styleSheet').href = sheet;
}
</script>
</body>
</html>

