<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UK Railway Calendar Utility</title>
    <script src="auth.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --neon-cyan: #00ffff;
            --neon-magenta: #ff00ff;
            --neon-amber: #ffbf00;
            --dark-bg: #0a0a0f;
            --dark-panel: #151520;
            --dark-card: #1a1a2e;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
        }

        body {
            font-family: 'Segoe UI', 'Roboto', 'Arial', sans-serif;
            background: linear-gradient(135deg, var(--dark-bg) 0%, #1a1a2e 100%);
            min-height: 100vh;
            color: var(--text-primary);
            padding: 20px;
            overflow-x: hidden;
        }

        /* Animated background grid */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                linear-gradient(rgba(0, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            background: var(--dark-panel);
            border-radius: 15px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4),
                        0 0 20px rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg,
                var(--neon-cyan) 0%,
                var(--neon-magenta) 50%,
                var(--neon-amber) 100%);
            animation: shimmer 3s linear infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .back-link {
            display: inline-block;
            color: var(--neon-cyan);
            text-decoration: none;
            font-size: 14px;
            margin-bottom: 15px;
            transition: all 0.3s;
            text-shadow: 0 0 10px var(--neon-cyan);
        }

        .back-link:hover {
            transform: translateX(-5px);
            text-shadow: 0 0 15px var(--neon-cyan);
        }

        h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-magenta));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1em;
            letter-spacing: 0.5px;
        }

        /* Info Panel */
        .info-panel {
            background: var(--dark-panel);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 0, 255, 0.2);
        }

        .current-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .info-card {
            background: var(--dark-card);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3),
                        inset 0 0 20px rgba(0, 255, 255, 0.05);
            transition: all 0.3s;
        }

        .info-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(0, 255, 255, 0.4),
                        inset 0 0 30px rgba(0, 255, 255, 0.1);
            border-color: var(--neon-cyan);
        }

        .info-label {
            font-size: 0.85em;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .info-value {
            font-size: 2.2em;
            font-weight: bold;
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-magenta));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .year-info {
            background: rgba(255, 191, 0, 0.1);
            border: 1px solid rgba(255, 191, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            color: var(--neon-amber);
            font-size: 0.95em;
            text-shadow: 0 0 10px rgba(255, 191, 0, 0.3);
        }

        /* View Mode Switcher */
        .view-controls {
            background: var(--dark-panel);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 191, 0, 0.2);
        }

        .resolution-switcher {
            display: flex;
            justify-content: center;
            gap: 0;
            background: var(--dark-card);
            border-radius: 12px;
            padding: 5px;
            margin-bottom: 20px;
            border: 1px solid rgba(0, 255, 255, 0.2);
        }

        .view-btn {
            flex: 1;
            padding: 12px 30px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 15px;
            font-weight: 600;
            border-radius: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .view-btn:hover {
            color: var(--neon-cyan);
            background: rgba(0, 255, 255, 0.1);
        }

        .view-btn.active {
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-magenta));
            color: var(--dark-bg);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        /* Timeline Scrubber */
        .timeline-scrubber {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .timeline-label {
            color: var(--text-secondary);
            font-size: 0.9em;
            min-width: 60px;
        }

        .timeline-slider {
            flex: 1;
            height: 6px;
            background: var(--dark-card);
            border-radius: 3px;
            position: relative;
            cursor: pointer;
            border: 1px solid rgba(0, 255, 255, 0.2);
        }

        .timeline-track {
            height: 100%;
            background: linear-gradient(90deg, var(--neon-cyan), var(--neon-magenta));
            border-radius: 3px;
            transition: width 0.3s;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .timeline-thumb {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 18px;
            height: 18px;
            background: var(--neon-cyan);
            border-radius: 50%;
            box-shadow: 0 0 15px var(--neon-cyan);
            transition: all 0.3s;
        }

        .timeline-thumb:hover {
            transform: translate(-50%, -50%) scale(1.3);
            box-shadow: 0 0 25px var(--neon-cyan);
        }

        /* Navigation */
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            background: var(--dark-card);
            color: var(--neon-cyan);
            border: 1px solid var(--neon-cyan);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .nav-btn:hover {
            background: var(--neon-cyan);
            color: var(--dark-bg);
            box-shadow: 0 0 20px var(--neon-cyan);
            transform: translateY(-2px);
        }

        .current-view-title {
            font-size: 1.8em;
            font-weight: bold;
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-magenta));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Calendar Container */
        .calendar-container {
            background: var(--dark-panel);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 0, 255, 0.2);
            min-height: 500px;
        }

        /* Week View */
        .week-view {
            display: none;
        }

        .week-view.active {
            display: block;
        }

        .rail-week-track {
            background: var(--dark-card);
            border-radius: 12px;
            padding: 30px;
            margin-top: 20px;
            border: 1px solid rgba(0, 255, 255, 0.2);
        }

        .track-timeline {
            position: relative;
            height: 80px;
            background: linear-gradient(90deg,
                rgba(0, 255, 255, 0.1) 0%,
                rgba(255, 0, 255, 0.1) 100%);
            border-radius: 8px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .track-rail {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--neon-cyan), var(--neon-magenta));
            box-shadow: 0 0 10px var(--neon-cyan);
        }

        .week-days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 15px;
        }

        .week-day-card {
            background: var(--dark-card);
            border: 2px solid rgba(0, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .week-day-card:hover {
            transform: translateY(-5px);
            border-color: var(--neon-cyan);
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.4);
        }

        .week-day-card.today {
            border-color: var(--neon-magenta);
            background: rgba(255, 0, 255, 0.1);
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.3);
        }

        .week-day-name {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .week-day-date {
            font-size: 2em;
            font-weight: bold;
            color: var(--neon-cyan);
            margin-bottom: 8px;
        }

        .week-day-info {
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        /* Month View */
        .month-view {
            display: none;
        }

        .month-view.active {
            display: block;
        }

        .month-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .month-day-header {
            text-align: center;
            font-weight: bold;
            padding: 12px;
            color: var(--neon-cyan);
            font-size: 0.95em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .month-day-cell {
            aspect-ratio: 1;
            background: var(--dark-card);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 10px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }

        .month-day-cell:hover {
            transform: scale(1.05);
            border-color: var(--neon-cyan);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            z-index: 10;
        }

        .month-day-cell.other-month {
            opacity: 0.3;
        }

        .month-day-cell.today {
            background: linear-gradient(135deg,
                rgba(0, 255, 255, 0.2),
                rgba(255, 0, 255, 0.2));
            border-color: var(--neon-magenta);
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.4);
        }

        .month-day-cell.weekend {
            background: rgba(255, 191, 0, 0.05);
        }

        .month-day-cell.bank-holiday {
            background: rgba(255, 0, 255, 0.15);
            border-color: var(--neon-magenta);
        }

        .month-day-number {
            font-size: 1.3em;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .month-day-info {
            font-size: 0.7em;
            text-align: center;
            line-height: 1.3;
        }

        .week-label {
            color: var(--neon-cyan);
            font-weight: bold;
        }

        .period-label {
            color: var(--neon-magenta);
            font-weight: bold;
        }

        .holiday-indicator {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 8px;
            height: 8px;
            background: var(--neon-magenta);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--neon-magenta);
        }

        /* Year View */
        .year-view {
            display: none;
        }

        .year-view.active {
            display: block;
        }

        .year-periods {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .period-card {
            background: var(--dark-card);
            border: 1px solid rgba(255, 191, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }

        .period-card:hover {
            transform: translateY(-5px);
            border-color: var(--neon-amber);
            box-shadow: 0 0 25px rgba(255, 191, 0, 0.3);
        }

        .period-header {
            font-size: 1.3em;
            font-weight: bold;
            color: var(--neon-amber);
            margin-bottom: 15px;
            text-align: center;
        }

        .period-weeks {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .period-week {
            background: rgba(0, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 6px;
            padding: 10px;
            text-align: center;
            font-size: 0.9em;
            transition: all 0.3s;
            cursor: pointer;
        }

        .period-week:hover {
            background: rgba(0, 255, 255, 0.15);
            border-color: var(--neon-cyan);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }

        .period-week.current {
            background: rgba(255, 0, 255, 0.15);
            border-color: var(--neon-magenta);
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.3);
        }

        /* Legend */
        .legend {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }

        .legend-box {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid rgba(0, 255, 255, 0.3);
        }

        .legend-box.today {
            background: linear-gradient(135deg,
                rgba(0, 255, 255, 0.2),
                rgba(255, 0, 255, 0.2));
            border-color: var(--neon-magenta);
        }

        .legend-box.weekend {
            background: rgba(255, 191, 0, 0.05);
            border-color: rgba(255, 191, 0, 0.3);
        }

        .legend-box.holiday {
            background: rgba(255, 0, 255, 0.15);
            border-color: var(--neon-magenta);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .week-days-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            .current-info {
                grid-template-columns: 1fr;
            }

            .resolution-switcher {
                flex-direction: column;
            }

            .view-btn {
                width: 100%;
            }

            .week-days-grid {
                grid-template-columns: 1fr;
            }

            .month-calendar {
                gap: 5px;
            }

            .month-day-header,
            .month-day-number {
                font-size: 0.85em;
            }

            .month-day-info {
                font-size: 0.6em;
            }

            .navigation {
                flex-direction: column;
                align-items: stretch;
            }

            .nav-buttons {
                justify-content: center;
            }

            .current-view-title {
                text-align: center;
                font-size: 1.4em;
            }

            .year-periods {
                grid-template-columns: 1fr;
            }
        }

        /* Loading Animation */
        .loading {
            display: none;
            text-align: center;
            padding: 50px;
            color: var(--neon-cyan);
            font-size: 1.2em;
        }

        .loading.active {
            display: block;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading::after {
            content: '...';
            animation: pulse 1.5s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <a href="index.html" class="back-link">‚Üê Back to Home</a>
            <h1>UK Railway Calendar Utility</h1>
            <p class="subtitle">Network Rail Week Numbering ‚Ä¢ Railway Year Management ‚Ä¢ Control Centre Interface</p>
        </div>

        <!-- Current Info Panel -->
        <div class="info-panel">
            <div class="current-info">
                <div class="info-card">
                    <div class="info-label">Rail Week</div>
                    <div class="info-value" id="currentWeek">-</div>
                </div>
                <div class="info-card">
                    <div class="info-label">Day of Week</div>
                    <div class="info-value" id="currentDayOfWeek">-</div>
                </div>
                <div class="info-card">
                    <div class="info-label">Period</div>
                    <div class="info-value" id="currentPeriod">-</div>
                </div>
                <div class="info-card">
                    <div class="info-label">Railway Year</div>
                    <div class="info-value" id="railwayYear">-</div>
                </div>
            </div>
            <div id="yearInfo" class="year-info"></div>
        </div>

        <!-- View Controls -->
        <div class="view-controls">
            <div class="resolution-switcher">
                <button class="view-btn active" data-view="week" onclick="switchView('week')">Week</button>
                <button class="view-btn" data-view="month" onclick="switchView('month')">Month</button>
                <button class="view-btn" data-view="year" onclick="switchView('year')">Year</button>
            </div>
            <div class="timeline-scrubber">
                <div class="timeline-label">Navigate:</div>
                <div class="timeline-slider" id="timelineSlider">
                    <div class="timeline-track" id="timelineTrack"></div>
                    <div class="timeline-thumb" id="timelineThumb"></div>
                </div>
            </div>
        </div>

        <!-- Calendar Container -->
        <div class="calendar-container">
            <!-- Navigation -->
            <div class="navigation">
                <div class="nav-buttons">
                    <button class="nav-btn" onclick="navigatePrevious()">‚Üê Previous</button>
                    <button class="nav-btn" onclick="navigateToday()">Today</button>
                    <button class="nav-btn" onclick="navigateNext()">Next ‚Üí</button>
                </div>
                <div class="current-view-title" id="viewTitle"></div>
            </div>

            <!-- Week View -->
            <div class="week-view active" id="weekView">
                <div class="rail-week-track">
                    <div class="track-timeline">
                        <div class="track-rail"></div>
                    </div>
                    <div class="week-days-grid" id="weekDaysGrid"></div>
                </div>
            </div>

            <!-- Month View -->
            <div class="month-view" id="monthView">
                <div class="month-calendar" id="monthCalendar"></div>
            </div>

            <!-- Year View -->
            <div class="year-view" id="yearView">
                <div class="year-periods" id="yearPeriods"></div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-box today"></div>
                    <span>Today</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box weekend"></div>
                    <span>Weekend</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box holiday"></div>
                    <span>Bank Holiday</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Railway Calendar API Module -->
    <script src="railway-calendar-api.js"></script>

    <!-- Main Application Script -->
    <script>
        // Application State
        let currentView = 'week';
        let currentDate = new Date();
        let currentWeekStart = null;
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let currentRailwayYear = null;

        // Initialize the application
        function init() {
            updateCurrentInfo();
            renderCurrentView();
            setupTimelineScrubber();
        }

        // Update current info panel
        function updateCurrentInfo() {
            const today = new Date();
            const railInfo = RailwayCalendarAPI.getRailwayWeekInfo(today);

            document.getElementById('currentWeek').textContent = railInfo.week;
            document.getElementById('currentDayOfWeek').textContent = railInfo.dayOfWeek + 1;
            document.getElementById('currentPeriod').textContent = railInfo.period;
            document.getElementById('railwayYear').textContent = railInfo.railwayYear;

            const yearStart = RailwayCalendarAPI.getRailwayYearStart(today);
            const yearEnd = RailwayCalendarAPI.getRailwayYearEnd(yearStart);
            const totalWeeks = RailwayCalendarAPI.getWeeksInRailwayYear(railInfo.railwayYear);

            document.getElementById('yearInfo').innerHTML =
                `Railway Year ${railInfo.railwayYear}: ` +
                `${formatDate(yearStart)} to ${formatDate(yearEnd)} ‚Ä¢ ` +
                `${totalWeeks} weeks ‚Ä¢ ` +
                `Week 1 starts ${formatDate(RailwayCalendarAPI.getWeekStartEnd(railInfo.railwayYear, 1).start)}`;
        }

        // Switch between views
        function switchView(view) {
            currentView = view;

            // Update buttons
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.view === view);
            });

            // Update views
            document.getElementById('weekView').classList.toggle('active', view === 'week');
            document.getElementById('monthView').classList.toggle('active', view === 'month');
            document.getElementById('yearView').classList.toggle('active', view === 'year');

            renderCurrentView();
        }

        // Render current view
        function renderCurrentView() {
            switch (currentView) {
                case 'week':
                    renderWeekView();
                    break;
                case 'month':
                    renderMonthView();
                    break;
                case 'year':
                    renderYearView();
                    break;
            }
        }

        // Render Week View
        function renderWeekView() {
            const date = currentWeekStart || new Date();
            const railInfo = RailwayCalendarAPI.getRailwayWeekInfo(date);
            const weekDates = RailwayCalendarAPI.getWeekStartEnd(railInfo.railwayYear, railInfo.week);

            document.getElementById('viewTitle').textContent =
                `Week ${railInfo.week}, ${railInfo.railwayYear}`;

            const grid = document.getElementById('weekDaysGrid');
            grid.innerHTML = '';

            const dayNames = ['Sat', 'Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri'];
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            for (let i = 0; i < 7; i++) {
                const dayDate = new Date(weekDates.start);
                dayDate.setDate(dayDate.getDate() + i);

                const card = document.createElement('div');
                card.className = 'week-day-card';

                if (dayDate.getTime() === today.getTime()) {
                    card.classList.add('today');
                }

                const holiday = RailwayCalendarAPI.getBankHoliday(dayDate);
                const holidayHTML = holiday ?
                    `<div style="color: var(--neon-magenta); font-size: 0.75em; margin-top: 5px;">üéâ ${holiday}</div>` : '';

                card.innerHTML = `
                    <div class="week-day-name">${dayNames[i]}</div>
                    <div class="week-day-date">${dayDate.getDate()}</div>
                    <div class="week-day-info">
                        ${formatDate(dayDate)}
                        ${holidayHTML}
                    </div>
                `;

                grid.appendChild(card);
            }
        }

        // Render Month View
        function renderMonthView() {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];

            document.getElementById('viewTitle').textContent =
                `${monthNames[currentMonth]} ${currentYear}`;

            const calendar = document.getElementById('monthCalendar');
            calendar.innerHTML = '';

            // Day headers
            const dayNames = ['Sat', 'Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri'];
            dayNames.forEach(day => {
                const header = document.createElement('div');
                header.className = 'month-day-header';
                header.textContent = day;
                calendar.appendChild(header);
            });

            // Calculate first day and days in month
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const daysInMonth = lastDay.getDate();

            // Adjust to start on Saturday
            let startDay = firstDay.getDay();
            startDay = (startDay + 1) % 7; // Convert so Saturday = 0

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // Add empty cells for previous month
            for (let i = 0; i < startDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'month-day-cell other-month';
                const prevDate = new Date(currentYear, currentMonth, 1 - (startDay - i));
                emptyCell.innerHTML = `<div class="month-day-number">${prevDate.getDate()}</div>`;
                calendar.appendChild(emptyCell);
            }

            // Add days of month
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(currentYear, currentMonth, day);
                const cell = document.createElement('div');
                cell.className = 'month-day-cell';

                const dayOfWeek = date.getDay();
                if (dayOfWeek === 0 || dayOfWeek === 6) {
                    cell.classList.add('weekend');
                }

                if (date.getTime() === today.getTime()) {
                    cell.classList.add('today');
                }

                const railInfo = RailwayCalendarAPI.getRailwayWeekInfo(date);
                const holiday = RailwayCalendarAPI.getBankHoliday(date);

                if (holiday) {
                    cell.classList.add('bank-holiday');
                    const indicator = document.createElement('div');
                    indicator.className = 'holiday-indicator';
                    indicator.title = holiday;
                    cell.appendChild(indicator);
                }

                cell.innerHTML += `
                    <div class="month-day-number">${day}</div>
                    <div class="month-day-info">
                        <div class="week-label">W${railInfo.week}</div>
                        <div class="period-label">P${railInfo.period}</div>
                    </div>
                `;

                calendar.appendChild(cell);
            }

            // Add remaining cells
            const totalCells = calendar.children.length - 7;
            const remainingCells = (7 - (totalCells % 7)) % 7;

            for (let i = 1; i <= remainingCells; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'month-day-cell other-month';
                emptyCell.innerHTML = `<div class="month-day-number">${i}</div>`;
                calendar.appendChild(emptyCell);
            }
        }

        // Render Year View
        function renderYearView() {
            const railYear = currentRailwayYear || RailwayCalendarAPI.getRailwayWeekInfo(new Date()).railwayYear;
            const totalWeeks = RailwayCalendarAPI.getWeeksInRailwayYear(railYear);
            const totalPeriods = Math.ceil(totalWeeks / 4);

            document.getElementById('viewTitle').textContent = `Railway Year ${railYear}`;

            const container = document.getElementById('yearPeriods');
            container.innerHTML = '';

            const today = new Date();
            const currentRailInfo = RailwayCalendarAPI.getRailwayWeekInfo(today);

            for (let period = 1; period <= totalPeriods; period++) {
                const card = document.createElement('div');
                card.className = 'period-card';

                const startWeek = (period - 1) * 4 + 1;
                const endWeek = Math.min(period * 4, totalWeeks);

                const periodStart = RailwayCalendarAPI.getWeekStartEnd(railYear, startWeek).start;
                const periodEnd = RailwayCalendarAPI.getWeekStartEnd(railYear, endWeek).end;

                card.innerHTML = `
                    <div class="period-header">Period ${period}</div>
                    <div style="text-align: center; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 15px;">
                        ${formatDate(periodStart)} - ${formatDate(periodEnd)}
                    </div>
                    <div class="period-weeks" id="period-${period}"></div>
                `;

                container.appendChild(card);

                const weeksContainer = document.getElementById(`period-${period}`);
                for (let week = startWeek; week <= endWeek; week++) {
                    const weekDiv = document.createElement('div');
                    weekDiv.className = 'period-week';

                    if (railYear === currentRailInfo.railwayYear && week === currentRailInfo.week) {
                        weekDiv.classList.add('current');
                    }

                    const weekDates = RailwayCalendarAPI.getWeekStartEnd(railYear, week);
                    weekDiv.innerHTML = `
                        <div style="font-weight: bold; margin-bottom: 5px;">Week ${week}</div>
                        <div style="font-size: 0.8em; color: var(--text-secondary);">
                            ${formatDateShort(weekDates.start)} - ${formatDateShort(weekDates.end)}
                        </div>
                    `;

                    weekDiv.onclick = () => {
                        currentWeekStart = weekDates.start;
                        switchView('week');
                    };

                    weeksContainer.appendChild(weekDiv);
                }
            }
        }

        // Navigation functions
        function navigatePrevious() {
            switch (currentView) {
                case 'week':
                    const date = currentWeekStart || new Date();
                    const prevWeek = new Date(date);
                    prevWeek.setDate(prevWeek.getDate() - 7);
                    currentWeekStart = prevWeek;
                    renderWeekView();
                    break;
                case 'month':
                    currentMonth--;
                    if (currentMonth < 0) {
                        currentMonth = 11;
                        currentYear--;
                    }
                    renderMonthView();
                    break;
                case 'year':
                    const railYear = currentRailwayYear ||
                        RailwayCalendarAPI.getRailwayWeekInfo(new Date()).railwayYear;
                    currentRailwayYear = railYear - 1;
                    renderYearView();
                    break;
            }
        }

        function navigateNext() {
            switch (currentView) {
                case 'week':
                    const date = currentWeekStart || new Date();
                    const nextWeek = new Date(date);
                    nextWeek.setDate(nextWeek.getDate() + 7);
                    currentWeekStart = nextWeek;
                    renderWeekView();
                    break;
                case 'month':
                    currentMonth++;
                    if (currentMonth > 11) {
                        currentMonth = 0;
                        currentYear++;
                    }
                    renderMonthView();
                    break;
                case 'year':
                    const railYear = currentRailwayYear ||
                        RailwayCalendarAPI.getRailwayWeekInfo(new Date()).railwayYear;
                    currentRailwayYear = railYear + 1;
                    renderYearView();
                    break;
            }
        }

        function navigateToday() {
            currentDate = new Date();
            currentWeekStart = null;
            currentMonth = currentDate.getMonth();
            currentYear = currentDate.getFullYear();
            currentRailwayYear = null;
            renderCurrentView();
        }

        // Timeline Scrubber Setup
        function setupTimelineScrubber() {
            const slider = document.getElementById('timelineSlider');
            const thumb = document.getElementById('timelineThumb');
            let isDragging = false;

            slider.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);

            slider.addEventListener('touchstart', startDrag);
            document.addEventListener('touchmove', drag);
            document.addEventListener('touchend', stopDrag);

            function startDrag(e) {
                isDragging = true;
                updatePosition(e);
            }

            function drag(e) {
                if (!isDragging) return;
                updatePosition(e);
            }

            function stopDrag() {
                isDragging = false;
            }

            function updatePosition(e) {
                const rect = slider.getBoundingClientRect();
                const x = (e.clientX || e.touches[0].clientX) - rect.left;
                const percent = Math.max(0, Math.min(100, (x / rect.width) * 100));

                thumb.style.left = percent + '%';
                document.getElementById('timelineTrack').style.width = percent + '%';

                // Update view based on position
                if (currentView === 'week') {
                    const weekOffset = Math.floor((percent / 100) * 52) - 26;
                    const newDate = new Date();
                    newDate.setDate(newDate.getDate() + (weekOffset * 7));
                    currentWeekStart = newDate;
                    renderWeekView();
                } else if (currentView === 'month') {
                    const monthOffset = Math.floor((percent / 100) * 24) - 12;
                    const newDate = new Date();
                    newDate.setMonth(newDate.getMonth() + monthOffset);
                    currentMonth = newDate.getMonth();
                    currentYear = newDate.getFullYear();
                    renderMonthView();
                } else if (currentView === 'year') {
                    const yearOffset = Math.floor((percent / 100) * 10) - 5;
                    const today = new Date();
                    const railInfo = RailwayCalendarAPI.getRailwayWeekInfo(today);
                    currentRailwayYear = railInfo.railwayYear + yearOffset;
                    renderYearView();
                }
            }
        }

        // Utility functions
        function formatDate(date) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return date.toLocaleDateString('en-GB', options);
        }

        function formatDateShort(date) {
            const options = { month: 'short', day: 'numeric' };
            return date.toLocaleDateString('en-GB', options);
        }

        // Initialize on load
        init();
    </script>
</body>
</html>
